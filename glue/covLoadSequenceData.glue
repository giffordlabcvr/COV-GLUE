  # project build step that focuses on loading the sequence data and applying any quality filters to it.


  run script glue/covLoadTimeStamp.js

  # Sequence lengths
  run script glue/covSetSequenceLengths.js 
 
  # Metadata
  # have to temporarily change result format to avoid bug in table rendering library.
  console set cmd-result-format tab
  module covGisaidAcknowledgementsTextFilePopulator populate --fileName tabular/gisaid_cov2020_acknowledgement_table.txt
  module covGisaidMetadataTextFilePopulator populate --fileName tabular/gisaid_metadata.txt
  module covSeqStatsTextFilePopulator populate -f tabular/gisaidSeqCharacterStats.txt
  console unset cmd-result-format

  # deals with case where FASTA is ahead of either metadata (submission_year = null) or acknowledgements (isolate = null).
  # in this case we just remove these sequences.
  # the reverse case is dealt with by skipMissing flags in the TextFilePopulators.
  delete sequence -w "source.name = 'cov-gisaid' and (submission_year = null or isolate = null)"

  
  run file glue/covFeatures.glue

  run file glue/covMasterReference.glue
  run script glue/covCheckFeatureLocations.js

  # this is a dummy alignment really, it just contains the reference in order for a linking alignment to exist.
  create alignment AL_GISAID_UNCONSTRAINED
  alignment AL_GISAID_UNCONSTRAINED
    add member cov-gisaid EPI_ISL_402125
    member cov-gisaid EPI_ISL_402125 
      add segment 1 29903 1 29903
      exit
    exit  
  